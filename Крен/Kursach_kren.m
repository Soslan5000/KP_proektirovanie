clc
clear


% Определение параметров системы
H = 5;
M = 0.6;
V = 192;
Zb = -0.2;
sin = 0.08;
cos = 1;
g_del_V = 0.051;

M_x_b = -5.8;
M_x_omx = -1;
M_x_omy = -0.2;
M_x_sigme = -7;
M_y_b = -3;
M_y_omx = -0.05;
M_y_omy = -0.2;
M_y_sigmn = -2.5;

om_pr = 20;
kzi_pr = sqrt(2)/2;


% Синтез параметров
a = 4; % Коэффициент пропорциональности между tpp и временем релаксации
kzi = sqrt(a^2/(pi^2+a^2)); % Коэффициент затухания
t_pp = 1; % Задаём примерное время переходного процесса
om0 = a / kzi / t_pp; % Определяем собственную частоту колебаний
T = 2*pi / (om0*sqrt(1-kzi^2)); % Определяем  время релаксации

disp('Синтезированные коэффициенты')
k_sigm = - om0^2 / M_x_sigme % Значение коэффициент k_sigm
k_omx = - (M_x_omx + 2*kzi*om0) / M_x_sigme % Определяем коэффициент k_omx


% Построение переходного процесса в системе с учётом привода
% с синтезированными коэффициентами
W1 = tf(M_x_sigme, [1 -M_x_omx]); % ПФ по угловой скорости
W2 = tf(om_pr^2, [1 2*kzi_pr*om_pr om_pr^2]); % ПФ привода
W3 = W1*W2; % Связываем W1 и W2
integr = tf(1, [1, 0]); % ПФ интегратора
W4 = feedback(W3, k_omx, 1); % Положительная ОС по угловой скорости
W5 = k_sigm * W4 * integr; % Разомкнутая цепь по углу крена
disp('ПФ замкнутой цепи по углу крена с учётом привода')
W6 = feedback(W5, 1, 1) % Замкнутая цепь по углу крена
disp('Корни характеристического уравнения')
roots(W6.denominator{1}) % Корни характеристического уравнения
figure;
step(-1*W6); % Построение переходного процесса


% Построение переходного процесса в системе без учёта привода
% с синтезированными коэффициентами
W1 = tf(M_x_sigme, [1 -M_x_omx]); % ПФ по угловой скорости
integr = tf(1, [1, 0]); % ПФ интегратора
W2 = feedback(W1, k_omx, 1); % Положительная ОС по угловой скорости
W3 = k_sigm * W2 * integr; % Разомкнутая цепь по углу крена
disp('ПФ замкнутой цепи по углу крена без учёта привода')
W4 = feedback(W3, 1, 1) % Замкнутая цепь по углу крена
disp('Корни характеристического уравнения')
roots(W4.denominator{1}) % Корни характеристического уравнения
hold on
step(-1*W4); % Построение переходного процесса
hold off
grid on
legend('С учётом динамики привода','Без учёта динамики привода')


% Корни, полученные при моделирования в NCD-блоке
disp('Плученные в NCD-блоке коэффициенты')
k_sigm = 5.4231
k_omx = 1.2597


% Те же самые построение только уже для подобранных в NCD-блоке
% коэффициентов
W1 = tf(M_x_sigme, [1 -M_x_omx]);
W2 = tf(om_pr^2, [1 2*kzi_pr*om_pr om_pr^2]);
W3 = W1*W2;
integr = tf(1, [1, 0]);
W4 = feedback(W3, k_omx, 1);
W5 = k_sigm * W4 * integr;
disp('ПФ замкнутой цепи по углу крена с учётом привода')
W6 = feedback(W5, 1, 1)
disp('Корни характеристического уравнения')
roots(W6.denominator{1})
figure;
step(-1*W6)


W1 = tf(M_x_sigme, [1 -M_x_omx]);
integr = tf(1, [1, 0]);
W2 = feedback(W1, k_omx, 1);
W3 = k_sigm * W2 * integr;
disp('ПФ замкнутой цепи по углу крена без учёта привода')
W4 = feedback(W3, 1, 1)
disp('Корни характеристического уравнения')
roots(W4.denominator{1})
hold on
step(-1*W4)
hold off
legend('С учётом динамики привода','Без учёта динамики привода')
grid on